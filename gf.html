<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>åƒè§’å­è€è™æ©Ÿ - æ³¢å£«é “èŠ±ç”Ÿå¥¶æ²¹å ¡</title>
  <style>
    body {
      font-family: 'Arial Rounded MT Bold', 'Arial', sans-serif;
      background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 0;
      padding: 20px;
      color: #2d3436;
    }
    
    .container {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      padding: 30px;
      max-width: 600px;
      width: 100%;
      text-align: center;
    }
    
    h1 {
      color: #d35400;
      font-size: 2.5rem;
      margin-bottom: 20px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .input-group {
      margin: 20px 0;
    }
    
    label {
      display: block;
      margin-bottom: 10px;
      font-size: 1.2rem;
      font-weight: bold;
    }
    
    input {
      padding: 12px 15px;
      font-size: 1.1rem;
      border: 2px solid #3498db;
      border-radius: 10px;
      width: 250px;
      text-align: center;
    }
    
    button {
      background: #e67e22;
      color: white;
      border: none;
      padding: 12px 25px;
      font-size: 1.2rem;
      cursor: pointer;
      border-radius: 10px;
      margin: 15px 5px;
      transition: all 0.3s;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      font-weight: bold;
    }
    
    button:hover {
      background: #d35400;
      transform: translateY(-2px);
      box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
    }
    
    button:active {
      transform: translateY(1px);
    }
    
    button:disabled {
      background: #95a5a6;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    #message {
      color: #c0392b;
      font-weight: bold;
      min-height: 1.5em;
      margin: 15px 0;
      font-size: 1.1rem;
    }
    
    #gameArea {
      display: none;
      margin-top: 20px;
    }
    
    #slots {
      font-size: 5rem;
      margin: 30px 0;
      letter-spacing: 20px;
      min-height: 120px;
      display: flex;
      justify-content: center;
      align-items: center;
      background: rgba(52, 152, 219, 0.1);
      border-radius: 15px;
      padding: 15px;
    }
    
    #result {
      font-size: 1.8rem;
      font-weight: bold;
      min-height: 2.5em;
      margin: 20px 0;
      padding: 15px;
      border-radius: 10px;
    }
    
    .win {
      background: rgba(46, 204, 113, 0.2);
      color: #27ae60;
      animation: pulse 1s infinite;
    }
    
    .lose {
      background: rgba(231, 76, 60, 0.1);
      color: #c0392b;
    }
    
    .status-info {
      font-size: 1.1rem;
      margin: 10px 0;
      background: rgba(236, 240, 241, 0.7);
      padding: 10px;
      border-radius: 8px;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    @keyframes jackpot {
      0% { transform: scale(1); text-shadow: 0 0 5px gold; }
      50% { transform: scale(1.5); text-shadow: 0 0 20px gold; }
      100% { transform: scale(1); text-shadow: 0 0 5px gold; }
    }
    
    .jackpot {
      animation: jackpot 1s infinite;
      color: gold !important;
    }
    
    .slot-machine {
      position: relative;
      padding: 20px;
      border: 5px solid #e67e22;
      border-radius: 20px;
      background: #34495e;
      box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
    }
    
    .slot-machine::before {
      content: "";
      position: absolute;
      top: -15px;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 60px;
      background: #e74c3c;
      border-radius: 50%;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ” åƒè§’å­è€è™æ©Ÿ - æ³¢å£«é “èŠ±ç”Ÿå¥¶æ²¹å ¡ ğŸ¥œ</h1>
    
    <div class="input-group">
      <label for="codeInput">è«‹è¼¸å…¥éŠæˆ²ä»£ç¢¼ (å§“åæœ«å…©å­—+ä¸‰ç¢¼æ•¸å­—)ï¼š</label>
      <input 
        id="codeInput" 
        type="text" 
        maxlength="5" 
        placeholder="ä¾‹å¦‚ï¼šé˜¿æ˜899"
        autocomplete="off"
      />
    </div>
    
    <button id="checkBtn">é©—è­‰ä»£ç¢¼</button>
    <p id="message"></p>
    
    <div id="gameArea">
      <div class="slot-machine">
        <div id="slots">ğŸ” ğŸŸ ğŸ©</div>
      </div>
      
      <button id="spinBtn">æ—‹è½‰æ‹‰æ¡¿ï¼</button>
      <p id="result"></p>
      
      <div class="status-info">
        <p>ä»Šæ—¥éŠç©æ¬¡æ•¸ï¼š<span id="playCount">0/1</span></p>
        <p>ä¸‹æ¬¡å¯ç©æ™‚é–“ï¼š<span id="countdown">00:00:00</span></p>
      </div>
    </div>
  </div>

<script>
  // è¯·æ›¿æ¢ä¸ºä½ çš„Google Apps Scriptéƒ¨ç½²ID
  const scriptURL = 'https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec';

  // DOMå…ƒç´ 
  const elements = {
    codeInput: document.getElementById('codeInput'),
    checkBtn: document.getElementById('checkBtn'),
    message: document.getElementById('message'),
    gameArea: document.getElementById('gameArea'),
    slots: document.getElementById('slots'),
    spinBtn: document.getElementById('spinBtn'),
    result: document.getElementById('result'),
    playCount: document.getElementById('playCount'),
    countdown: document.getElementById('countdown')
  };

  // æ¸¸æˆé…ç½®
  const config = {
    jackpotIcon: 'ğŸ¥œ',
    icons: ["ğŸ”", "ğŸŒ­", "ğŸŸ", "ğŸ©", "ğŸ•", "ğŸ¥“", "ğŸ¥ª", "ğŸ—", "ğŸ¥œ"],
    jackpotChance: 0.02, // 2%
    maxPlays: 1,
    spinDuration: 2000 // æ—‹è½¬åŠ¨ç”»æŒç»­æ—¶é—´(ms)
  };

  // æ¸¸æˆçŠ¶æ€
  let gameState = {
    playerCode: '',
    canPlay: false,
    isSpinning: false
  };

  // éªŒè¯ä»£ç æ ¼å¼
  function validateCode(code) {
    return /^[\u4e00-\u9fa5]{2}\d{3}$/.test(code);
  }

  // æ£€æŸ¥èµ„æ ¼
  async function checkEligibility() {
    const code = elements.codeInput.value.trim();
    
    if (!validateCode(code)) {
      showMessage('æ ¼å¼éŒ¯èª¤ï¼è«‹è¼¸å…¥å§“åæœ«å…©å­—+ä¸‰ç¢¼æ•¸å­—ï¼ˆä¾‹å¦‚ï¼šé˜¿æ˜899ï¼‰', 'error');
      return;
    }
    
    showMessage('é©—è­‰ä¸­...', 'info');
    
    try {
      const response = await fetch(`${scriptURL}?action=check&code=${encodeURIComponent(code)}`);
      const data = await response.json();
      
      if (data.status === 'OK') {
        gameState.playerCode = code;
        showMessage('é©—è­‰æˆåŠŸï¼Œå¯ä»¥é–‹å§‹éŠæˆ²ï¼', 'success');
        elements.codeInput.disabled = true;
        elements.checkBtn.disabled = true;
        elements.gameArea.style.display = 'block';
        gameState.canPlay = true;
        updatePlayStatus();
      } else {
        showMessage(data.message || 'é©—è­‰å¤±æ•—ï¼Œè«‹æª¢æŸ¥ä»£ç¢¼æˆ–ç¨å¾Œå†è©¦', 'error');
        gameState.canPlay = false;
      }
    } catch (error) {
      showMessage('é€£ç·šéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦', 'error');
      console.error('éªŒè¯é”™è¯¯:', error);
    }
  }

  // æäº¤æ¸¸æˆè®°å½•
  async function submitRecord(isWin, prize) {
    try {
      const formData = new FormData();
      formData.append('action', 'record');
      formData.append('code', gameState.playerCode);
      formData.append('win', isWin ? 'æ˜¯' : 'å¦');
      formData.append('prize', prize);

      const response = await fetch(scriptURL, { 
        method: 'POST', 
        body: formData 
      });
      
      const data = await response.json();
      if (data.status === 'recorded') {
        console.log('æ¸¸æˆè®°å½•æäº¤æˆåŠŸ');
      }
    } catch (error) {
      console.error('æäº¤è®°å½•å¤±è´¥:', error);
    }
  }

  // æ›´æ–°æ¸¸æˆçŠ¶æ€
  function updatePlayStatus() {
    const today = new Date().toISOString().slice(0, 10);
    const lastPlayDate = localStorage.getItem('lastPlayDate');
    const playCount = parseInt(localStorage.getItem('playCount') || '0', 10);

    if (lastPlayDate === today && playCount >= config.maxPlays) {
      gameState.canPlay = false;
      elements.spinBtn.disabled = true;
      elements.spinBtn.textContent = 'ä»Šæ—¥å·²ç©é';
      startCountdownTimer();
    } else {
      gameState.canPlay = true;
      elements.spinBtn.disabled = false;
      elements.spinBtn.textContent = 'æ—‹è½‰æ‹‰æ¡¿ï¼';
      elements.countdown.textContent = '00:00:00';
    }
    
    elements.playCount.textContent = `${playCount}/${config.maxPlays}`;
  }

  // å¼€å§‹å€’è®¡æ—¶
  function startCountdownTimer() {
    const now = new Date();
    const nextDay = new Date(now);
    nextDay.setHours(24, 0, 0, 0);
    nextDay.setDate(nextDay.getDate() + 1);

    function update() {
      const diff = nextDay - new Date();
      
      if (diff <= 0) {
        localStorage.setItem('playCount', '0');
        localStorage.removeItem('lastPlayDate');
        updatePlayStatus();
        return;
      }
      
      const hours = String(Math.floor(diff / 3600000)).padStart(2, '0');
      const minutes = String(Math.floor((diff % 3600000) / 60000)).padStart(2, '0');
      const seconds = String(Math.floor((diff % 60000) / 1000)).padStart(2, '0');
      
      elements.countdown.textContent = `${hours}:${minutes}:${seconds}`;
      setTimeout(update, 1000);
    }
    
    update();
  }

  // æ—‹è½¬è€è™æœº
  async function spin() {
    if (!gameState.canPlay || gameState.isSpinning) return;
    
    gameState.isSpinning = true;
    elements.spinBtn.disabled = true;
    elements.result.textContent = 'è½‰å‹•ä¸­...';
    elements.result.className = '';
    
    // æ¸…ç©ºä¸­å¥–åŠ¨ç”»
    elements.slots.classList.remove('jackpot');
    
    const startTime = Date.now();
    const spinCount = Math.floor(config.spinDuration / 100);
    let currentSpin = 0;
    
    // æ—‹è½¬åŠ¨ç”»
    const spinInterval = setInterval(() => {
      const icons = Array(3).fill().map(() => 
        config.icons[Math.floor(Math.random() * config.icons.length)]
      );
      
      elements.slots.textContent = icons.join(' ');
      currentSpin++;
      
      // ç»“æŸæ—‹è½¬
      if (Date.now() - startTime > config.spinDuration) {
        clearInterval(spinInterval);
        finishSpin();
      }
    }, 100);
  }

  // å®Œæˆæ—‹è½¬å¹¶æ˜¾ç¤ºç»“æœ
  function finishSpin() {
    // ç”Ÿæˆæœ€ç»ˆç»“æœ
    const isJackpot = Math.random() < config.jackpotChance;
    const finalIcons = isJackpot 
      ? [config.jackpotIcon, config.jackpotIcon, config.jackpotIcon]
      : Array(3).fill().map(() => 
          config.icons[Math.floor(Math.random() * config.icons.length)]
        );
    
    // æ˜¾ç¤ºæœ€ç»ˆç»“æœ
    elements.slots.textContent = finalIcons.join(' ');
    
    // æ£€æŸ¥æ˜¯å¦ä¸­å¥–
    if (isJackpot) {
      elements.result.textContent = 'æ­å–œä¸­çï¼ä½ å¾—åˆ°æ³¢å£«é “èŠ±ç”Ÿå¥¶æ²¹å ¡ï¼';
      elements.result.className = 'win';
      elements.slots.classList.add('jackpot');
      submitRecord(true, 'æ³¢å£«é “èŠ±ç”Ÿå¥¶æ²¹å ¡');
      
      // ä¸­å¥–åŠ¨ç”»
      setTimeout(() => {
        alert('ğŸ‰ æ­å–œä½ ä¸­çï¼æ³¢å£«é “èŠ±ç”Ÿå¥¶æ²¹å ¡å·²ç¶“ç‚ºä½ ä¿ç•™ï¼');
      }, 500);
    } else {
      elements.result.textContent = 'å¾ˆéºæ†¾ï¼Œæœªä¸­çï¼Œè¬è¬åƒèˆ‡ï¼';
      elements.result.className = 'lose';
      submitRecord(false, 'æœªä¸­ç');
    }
    
    // æ›´æ–°æ¸¸æˆçŠ¶æ€
    const today = new Date().toISOString().slice(0, 10);
    localStorage.setItem('lastPlayDate', today);
    localStorage.setItem('playCount', config.maxPlays);
    updatePlayStatus();
    
    gameState.isSpinning = false;
  }

  // æ˜¾ç¤ºæ¶ˆæ¯
  function showMessage(text, type = 'info') {
    elements.message.textContent = text;
    elements.message.className = type;
  }

  // äº‹ä»¶ç›‘å¬
  elements.checkBtn.addEventListener('click', checkEligibility);
  elements.spinBtn.addEventListener('click', spin);

  // åˆå§‹åŒ–
  document.addEventListener('DOMContentLoaded', () => {
    // æ£€æŸ¥æ˜¯å¦æœ‰ä¿å­˜çš„ä»£ç 
    const savedCode = localStorage.getItem('playerCode');
    if (savedCode) {
      elements.codeInput.value = savedCode;
    }
    
    // æ£€æŸ¥æ˜¯å¦å·²ç»ç©è¿‡
    updatePlayStatus();
  });
</script>
</body>
</html>
