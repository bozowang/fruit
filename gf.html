<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>æ°´æœåƒè§’å­è€è™æ©Ÿ</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 2em; }
    input, button { font-size: 1.2em; margin: 0.5em; }
    #result { font-size: 1.5em; margin-top: 1em; color: green; }
    #error { font-size: 1.2em; margin-top: 1em; color: red; }
  </style>
</head>
<body>
  <h1>æ°´æœåƒè§’å­è€è™æ©Ÿ</h1>
  <p>è«‹è¼¸å…¥ä½ çš„ä»£ç¢¼åƒåŠ éŠæˆ²ï¼š</p>
  <input type="text" id="codeInput" placeholder="è¼¸å…¥ä»£ç¢¼">
  <button onclick="startGame()">é–‹å§‹éŠæˆ²</button>

  <div id="result"></div>
  <div id="error"></div>

  <script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbwSc5XiIWEsSIIKdwgFn1d20wBMJqJUFAE5BEoaQbQjH1ZLab4qyWGkYSNnTftxfd4/exec';

    async function startGame() {
      const code = document.getElementById("codeInput").value.trim();
      const resultDiv = document.getElementById("result");
      const errorDiv = document.getElementById("error");
      resultDiv.textContent = '';
      errorDiv.textContent = '';

      if (!code) {
        errorDiv.textContent = "è«‹è¼¸å…¥ä»£ç¢¼ï¼";
        return;
      }

      // ç¬¬ä¸€æ­¥ï¼šæª¢æŸ¥ä»£ç¢¼
      try {
        const checkRes = await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'check', code })
        });
        const checkData = await checkRes.json();

        if (checkData.status !== 'ok') {
          errorDiv.textContent = checkData.message || "ä»£ç¢¼éŒ¯èª¤ï¼Œç„¡æ³•åƒåŠ éŠæˆ²ã€‚";
          return;
        }

        // æ¨¡æ“¬è½‰è¼ªçµæœï¼ˆ20ç¨®åœ–æ¡ˆï¼‰
        const icons = ['ğŸ','ğŸŠ','ğŸ‡','ğŸ‰','ğŸŒ','ğŸ','ğŸ¥','ğŸ’','ğŸ“','ğŸ‘','ğŸ¥¥','ğŸˆ','ğŸ','ğŸ¥­','ğŸ‹','ğŸ«','ğŸ','ğŸŒ½','ğŸ¥•','ğŸ§„'];
        const r1 = Math.floor(Math.random() * icons.length);
        const r2 = Math.floor(Math.random() * icons.length);
        const r3 = Math.floor(Math.random() * icons.length);
        const win = (r1 === r2 && r2 === r3);
        const prize = win ? "æ³¢å£«é “èŠ±ç”Ÿå¥¶æ²¹å ¡" : "";
        const resultStr = icons[r1] + " " + icons[r2] + " " + icons[r3];

        resultDiv.textContent = win 
          ? `ğŸ‰ æ­å–œä¸­çï¼${resultStr}ï¼Œç²å¾—ï¼š${prize}`
          : `æœªä¸­çï¼š${resultStr}`;

        // ç¬¬äºŒæ­¥ï¼šè¨˜éŒ„çµæœ
        await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'record',
            code: code,
            win: win,
            prize: prize,
            result: resultStr
          })
        });

      } catch (err) {
        console.error(err);
        errorDiv.textContent = "ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚";
      }
    }
  </script>
</body>
</html>
